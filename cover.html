<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Covers - Coverly</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <style>
        /* Additional styles for covers page */
        .page-header {
            text-align: center;
            padding: 40px 0 20px;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .page-header p {
            color: var(--gray);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .advanced-filters {
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin: 30px 0;
        }
        
        .filter-section {
            margin-bottom: 25px;
        }
        
        .filter-section h3 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.2rem;
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .filter-btn:hover {
            background: var(--secondary);
        }
        
        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .price-range {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .price-range input {
            width: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .sort-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        
        .results-count {
            color: var(--gray);
        }
        
        .view-options {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .view-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .comparison-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 30px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }
        
        .comparison-bar.active {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .sort-options {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .view-options {
                align-self: flex-end;
            }
            
            .filter-options {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo">
                    <div class="logo-icon">C</div>
                    <span>Coverly</span>
                </a>
                
                <div class="nav-links" id="navLinks">
                    <a href="index.html">Home</a>
                    <a href="cover.html" class="active">Covers</a>
                    <a href="accessories.html">Accessories</a>
                    <a href="cart.html">Cart</a>
                    <a href="wishlist.html">Wishlist</a>
                    <a href="admin.html" id="adminNavLink" style="display: none;">Admin</a>
                </div>
                
                <div class="nav-actions">
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Search covers...">
                        <button id="searchButton"><i class="fas fa-search"></i></button>
                    </div>
                    
                    <a href="wishlist.html" class="wishlist-icon" style="position: relative; margin-right: 15px; color: var(--dark); text-decoration: none;">
                        <i class="far fa-heart"></i>
                        <span class="wishlist-count" style="position: absolute; top: -8px; right: -8px; background-color: var(--primary); color: white; font-size: 0.8rem; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">0</span>
                    </a>
                    
                    <a href="cart.html" class="cart-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </a>
                    
                    <a href="admin.html" class="admin-link" id="adminLink" style="display: none; margin-left: 15px; color: var(--accent);">
                        <i class="fas fa-cog"></i>
                    </a>
                    
                    <div class="mobile-toggle" id="mobileToggle">
                        <i class="fas fa-bars"></i>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Page Header -->
    <section class="container page-header">
        <h1>Phone Covers Collection</h1>
        <p>Protect your device in style with our premium collection of phone covers. Find the perfect match for your personality!</p>
    </section>

    <!-- Advanced Filters -->
    <section class="container">
        <div class="advanced-filters">
            <div class="filter-section">
                <h3>Filter by Type</h3>
                <div class="filter-options">
                    <button class="filter-btn active" data-filter="all">All Covers</button>
                    <button class="filter-btn" data-filter="leather">Leather</button>
                    <button class="filter-btn" data-filter="silicone">Silicone</button>
                    <button class="filter-btn" data-filter="clear">Clear</button>
                    <button class="filter-btn" data-filter="shockproof">Shockproof</button>
                    <button class="filter-btn" data-filter="wallet">Wallet Cases</button>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>Price Range</h3>
                <div class="price-range">
                    <input type="number" id="minPriceFilter" placeholder="Min $" value="0">
                    <span>to</span>
                    <input type="number" id="maxPriceFilter" placeholder="Max $" value="100">
                    <button class="btn" id="applyPriceFilter">Apply</button>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>Filter by Rating</h3>
                <div class="filter-options">
                    <button class="filter-btn" data-rating="4">& Up <i class="fas fa-star"></i></button>
                    <button class="filter-btn" data-rating="3">& Up <i class="fas fa-star"></i></button>
                    <button class="filter-btn" data-rating="2">& Up <i class="fas fa-star"></i></button>
                </div>
            </div>
        </div>
    </section>

    <!-- Sort Options -->
    <section class="container">
        <div class="sort-options">
            <div class="results-count">
                Showing <span id="resultsCount">0</span> products
            </div>
            
            <div>
                <select id="sortSelect" style="padding: 8px 15px; border: 1px solid #ddd; border-radius: 6px; margin-right: 15px;">
                    <option value="default">Sort by: Default</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="rating">Highest Rated</option>
                    <option value="popular">Most Popular</option>
                    <option value="newest">Newest</option>
                </select>
                
                <div class="view-options">
                    <button class="view-btn active" data-view="grid"><i class="fas fa-th"></i></button>
                    <button class="view-btn" data-view="list"><i class="fas fa-list"></i></button>
                </div>
            </div>
        </div>
    </section>

    <!-- Covers Grid -->
    <section class="container">
        <div class="products-grid" id="coversGrid">
            <!-- Covers will be loaded by JavaScript -->
        </div>
        
        <!-- Loading More -->
        <div id="loadingMore" style="text-align: center; padding: 40px; display: none;">
            <div class="loading-spinner"></div>
            <p>Loading more products...</p>
        </div>
        
        <!-- No Results -->
        <div id="noResults" style="text-align: center; padding: 60px; display: none;">
            <h3>No products found</h3>
            <p>Try adjusting your filters or search terms</p>
            <button class="btn" id="resetFilters">Reset All Filters</button>
        </div>
    </section>

    <!-- Product Comparison Bar -->
    <div class="comparison-bar" id="comparisonBar">
        <div>
            <span id="comparisonCount">0</span> products selected for comparison
        </div>
        <div>
            <button class="btn" id="compareBtn" style="margin-right: 10px;">Compare Now</button>
            <button class="btn btn-secondary" id="clearComparison">Clear</button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <div class="footer-logo">Coverly<span>.</span></div>
                    <p>Coverly is your one-stop shop for premium phone accessories. We offer high-quality products that combine style, protection, and functionality for your mobile devices.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-pinterest"></i></a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="cover.html">Phone Covers</a></li>
                        <li><a href="accessories.html">Accessories</a></li>
                        <li><a href="cart.html">Shopping Cart</a></li>
                        <li><a href="wishlist.html">My Wishlist</a></li>
                    </ul>
                </div>
                
                <div class="footer-contact">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-map-marker-alt"></i> 123 Tech Street, San Francisco, CA</p>
                    <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                    <p><i class="fas fa-envelope"></i> support@coverly.com</p>
                    <p><i class="fas fa-clock"></i> Mon-Sat: 9AM - 8PM</p>
                </div>
                
                <div class="footer-info">
                    <h3>Customer Service</h3>
                    <ul>
                        <li><a href="#">Shipping Policy</a></li>
                        <li><a href="#">Return Policy</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms & Conditions</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Coverly. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Button -->
    <a href="https://wa.me/15551234567" class="whatsapp-btn" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Product Detail Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="product-modal">
            <button class="close-modal" id="closeModal">&times;</button>
            <div class="modal-content" id="modalContent">
                <!-- Product details will be loaded by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div class="modal-overlay" id="comparisonModal" style="z-index: 2000;">
        <div class="product-modal" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <button class="close-modal" id="closeComparison">&times;</button>
            <div id="comparisonContent" style="padding: 30px;">
                <!-- Comparison content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="product.js"></script>
    <script src="cart.js"></script>
    <script>
        // Mobile Navigation Toggle
        const mobileToggle = document.getElementById('mobileToggle');
        const navLinks = document.getElementById('navLinks');
        
        mobileToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });
        
        // State management
        let currentFilters = {
            type: 'all',
            minPrice: 0,
            maxPrice: 100,
            rating: null,
            sortBy: 'default'
        };
        
        let comparisonProducts = new Set();
        let currentView = 'grid';
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check admin login status
            const isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            const adminLink = document.getElementById('adminLink');
            const adminNavLink = document.getElementById('adminNavLink');
            
            if (isAdminLoggedIn && adminLink && adminNavLink) {
                adminLink.style.display = 'block';
                adminNavLink.style.display = 'block';
            }
            
            // Load covers
            loadCovers();
            
            // Load cart and wishlist counts
            if (window.updateCartCount) window.updateCartCount();
            if (window.updateWishlistCount) window.updateWishlistCount();
            
            // Setup event listeners
            setupFilters();
            setupSorting();
            setupViewToggle();
            setupSearch();
            
            // Update results count
            updateResultsCount();
        });
        
        // Load covers with filters
        function loadCovers() {
            const coversGrid = document.getElementById('coversGrid');
            const loadingMore = document.getElementById('loadingMore');
            const noResults = document.getElementById('noResults');
            
            if (!coversGrid) return;
            
            // Show loading
            coversGrid.innerHTML = '';
            loadingMore.style.display = 'block';
            noResults.style.display = 'none';
            
            // Get filtered products
            let filteredProducts = window.products.filter(product => 
                product.category === 'cover'
            );
            
            // Apply type filter
            if (currentFilters.type !== 'all') {
                filteredProducts = filteredProducts.filter(product => 
                    product.name.toLowerCase().includes(currentFilters.type) ||
                    product.description.toLowerCase().includes(currentFilters.type)
                );
            }
            
            // Apply price filter
            filteredProducts = filteredProducts.filter(product => 
                product.price >= currentFilters.minPrice && 
                product.price <= currentFilters.maxPrice
            );
            
            // Apply rating filter
            if (currentFilters.rating) {
                filteredProducts = filteredProducts.filter(product => 
                    product.rating >= currentFilters.rating
                );
            }
            
            // Apply sorting
            if (window.sortProducts) {
                filteredProducts = window.sortProducts(filteredProducts, currentFilters.sortBy);
            }
            
            // Simulate loading delay
            setTimeout(() => {
                loadingMore.style.display = 'none';
                
                if (filteredProducts.length === 0) {
                    noResults.style.display = 'block';
                    return;
                }
                
                // Display products
                filteredProducts.forEach(product => {
                    const productCard = createCoverCard(product);
                    coversGrid.appendChild(productCard);
                });
                
                // Update results count
                updateResultsCount(filteredProducts.length);
                
                // Setup comparison checkboxes
                setupComparison();
                
            }, 500);
        }
        
        // Create cover card with comparison
        function createCoverCard(product) {
            const card = document.createElement('div');
            card.className = `product-card ${currentView === 'list' ? 'list-view' : ''}`;
            card.dataset.id = product.id;
            
            // Badge mapping
            const badgeTexts = {
                'new': 'NEW',
                'bestseller': 'BESTSELLER',
                'limited': 'LIMITED',
                'hot': 'HOT DEAL',
                'sale': 'SALE'
            };
            
            const badgeColors = {
                'new': '#4CAF50',
                'bestseller': '#FF9800',
                'limited': '#9C27B0',
                'hot': '#F44336',
                'sale': '#2196F3'
            };
            
            card.innerHTML = `
                ${product.discount ? `<div class="product-badge" style="background-color: ${badgeColors.sale || '#FFC8DD'}">${product.discount}% OFF</div>` : ''}
                ${product.badge && badgeTexts[product.badge] ? `
                    <div class="product-badge type-badge" style="background-color: ${badgeColors[product.badge] || '#A2D2FF'}; top: ${product.discount ? '45px' : '15px'}">
                        ${badgeTexts[product.badge]}
                    </div>
                ` : ''}
                
                ${product.stock < 10 ? `<div class="stock-badge">Only ${product.stock} left!</div>` : ''}
                
                <div class="product-image">
                    <img src="${product.image}" alt="${product.name}" loading="lazy">
                    <div class="product-overlay">
                        <a href="#" class="view-details" data-id="${product.id}">View Details</a>
                        <button class="quick-view" data-id="${product.id}">
                            <i class="fas fa-eye"></i> Quick View
                        </button>
                    </div>
                </div>
                <div class="product-info">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h3>${product.name}</h3>
                        <label class="compare-checkbox" style="cursor: pointer;">
                            <input type="checkbox" class="compare-product" data-id="${product.id}">
                            Compare
                        </label>
                    </div>
                    
                    <div class="product-rating">
                        ${generateStarRating(product.rating)}
                        <span class="rating-count">(${product.reviews})</span>
                    </div>
                    
                    <p class="product-description">${product.description}</p>
                    
                    <div class="product-price">
                        <div>
                            <span class="current-price">$${product.price.toFixed(2)}</span>
                            ${product.originalPrice ? `<span class="original-price">$${product.originalPrice.toFixed(2)}</span>` : ''}
                        </div>
                        ${product.stock ? `<div class="stock-info">In Stock: ${product.stock}</div>` : ''}
                    </div>
                    
                    <div class="product-actions">
                        <button class="add-to-cart" data-id="${product.id}">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                        <button class="add-to-wishlist" data-id="${product.id}">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listeners
            const addToCartBtn = card.querySelector('.add-to-cart');
            addToCartBtn.addEventListener('click', function() {
                const productId = parseInt(this.getAttribute('data-id'));
                window.addToCart(productId);
            });
            
            const viewDetailsBtn = card.querySelector('.view-details');
            viewDetailsBtn.addEventListener('click', function(e) {
                e.preventDefault();
                const productId = parseInt(this.getAttribute('data-id'));
                showProductDetails(productId);
            });
            
            const quickViewBtn = card.querySelector('.quick-view');
            if (quickViewBtn) {
                quickViewBtn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    showQuickView(productId);
                });
            }
            
            const wishlistBtn = card.querySelector('.add-to-wishlist');
            if (wishlistBtn) {
                wishlistBtn.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    window.toggleWishlist(productId);
                });
            }
            
            return card;
        }
        
        // Generate star rating
        function generateStarRating(rating) {
            let stars = '';
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            if (halfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            
            return stars;
        }
        
        // Setup filters
        function setupFilters() {
            // Type filters
            document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active state
                    document.querySelectorAll('.filter-btn[data-filter]').forEach(b => 
                        b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update filter
                    currentFilters.type = this.getAttribute('data-filter');
                    loadCovers();
                });
            });
            
            // Price filter
            const applyPriceFilter = document.getElementById('applyPriceFilter');
            if (applyPriceFilter) {
                applyPriceFilter.addEventListener('click', function() {
                    const minPrice = parseFloat(document.getElementById('minPriceFilter').value) || 0;
                    const maxPrice = parseFloat(document.getElementById('maxPriceFilter').value) || 100;
                    
                    if (minPrice > maxPrice) {
                        alert('Minimum price cannot be greater than maximum price');
                        return;
                    }
                    
                    currentFilters.minPrice = minPrice;
                    currentFilters.maxPrice = maxPrice;
                    loadCovers();
                });
            }
            
            // Rating filter
            document.querySelectorAll('.filter-btn[data-rating]').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Toggle active state
                    const rating = this.getAttribute('data-rating');
                    const isActive = this.classList.contains('active');
                    
                    if (isActive) {
                        this.classList.remove('active');
                        currentFilters.rating = null;
                    } else {
                        // Remove active from other rating buttons
                        document.querySelectorAll('.filter-btn[data-rating]').forEach(b => 
                            b.classList.remove('active'));
                        this.classList.add('active');
                        currentFilters.rating = parseFloat(rating);
                    }
                    
                    loadCovers();
                });
            });
            
            // Reset filters
            const resetFiltersBtn = document.getElementById('resetFilters');
            if (resetFiltersBtn) {
                resetFiltersBtn.addEventListener('click', function() {
                    // Reset all filters
                    currentFilters = {
                        type: 'all',
                        minPrice: 0,
                        maxPrice: 100,
                        rating: null,
                        sortBy: 'default'
                    };
                    
                    // Reset UI
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    document.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
                    
                    document.getElementById('minPriceFilter').value = '0';
                    document.getElementById('maxPriceFilter').value = '100';
                    document.getElementById('sortSelect').value = 'default';
                    
                    loadCovers();
                });
            }
        }
        
        // Setup sorting
        function setupSorting() {
            const sortSelect = document.getElementById('sortSelect');
            if (sortSelect) {
                sortSelect.addEventListener('change', function() {
                    currentFilters.sortBy = this.value;
                    loadCovers();
                });
            }
        }
        
        // Setup view toggle
        function setupViewToggle() {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active state
                    document.querySelectorAll('.view-btn').forEach(b => 
                        b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Update view
                    currentView = this.getAttribute('data-view');
                    const coversGrid = document.getElementById('coversGrid');
                    
                    if (coversGrid) {
                        if (currentView === 'list') {
                            coversGrid.classList.add('list-view');
                        } else {
                            coversGrid.classList.remove('list-view');
                        }
                    }
                });
            });
        }
        
        // Setup search
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            
            if (searchInput && searchButton) {
                searchButton.addEventListener('click', performSearch);
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') performSearch();
                });
            }
        }
        
        function performSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            // In a real implementation, you would filter products by search query
            console.log('Searching for:', query);
            alert(`Searching for: ${query}\nThis would filter the products in a real implementation.`);
        }
        
        // Setup comparison
        function setupComparison() {
            document.querySelectorAll('.compare-product').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    
                    if (this.checked) {
                        comparisonProducts.add(productId);
                    } else {
                        comparisonProducts.delete(productId);
                    }
                    
                    updateComparisonBar();
                });
            });
            
            // Compare button
            const compareBtn = document.getElementById('compareBtn');
            if (compareBtn) {
                compareBtn.addEventListener('click', showComparison);
            }
            
            // Clear comparison
            const clearComparisonBtn = document.getElementById('clearComparison');
            if (clearComparisonBtn) {
                clearComparisonBtn.addEventListener('click', function() {
                    comparisonProducts.clear();
                    document.querySelectorAll('.compare-product').forEach(cb => cb.checked = false);
                    updateComparisonBar();
                });
            }
        }
        
        // Update comparison bar
        function updateComparisonBar() {
            const comparisonBar = document.getElementById('comparisonBar');
            const comparisonCount = document.getElementById('comparisonCount');
            const compareBtn = document.getElementById('compareBtn');
            
            if (comparisonProducts.size > 0) {
                comparisonBar.classList.add('active');
                comparisonCount.textContent = comparisonProducts.size;
                
                // Enable/disable compare button
                if (compareBtn) {
                    compareBtn.disabled = comparisonProducts.size < 2;
                    compareBtn.title = comparisonProducts.size < 2 ? 
                        'Select at least 2 products to compare' : '';
                }
            } else {
                comparisonBar.classList.remove('active');
            }
        }
        
        // Show product comparison
        function showComparison() {
            if (comparisonProducts.size < 2) {
                alert('Please select at least 2 products to compare');
                return;
            }
            
            const productsToCompare = Array.from(comparisonProducts).map(id => 
                window.products.find(p => p.id === id)
            ).filter(p => p);
            
            // Create comparison table
            let comparisonHTML = '<h2 style="margin-bottom: 20px;">Product Comparison</h2>';
            comparisonHTML += '<div style="overflow-x: auto;">';
            comparisonHTML += '<table style="width: 100%; border-collapse: collapse;">';
            
            // Header row with images
            comparisonHTML += '<thead><tr>';
            comparisonHTML += '<th style="padding: 15px; text-align: left; border-bottom: 2px solid #eee;">Feature</th>';
            productsToCompare.forEach(product => {
                comparisonHTML += `
                    <th style="padding: 15px; text-align: center; border-bottom: 2px solid #eee;">
                        <img src="${product.image}" alt="${product.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
                        <div>${product.name}</div>
                        <div style="color: var(--accent); font-weight: bold; margin: 10px 0;">$${product.price.toFixed(2)}</div>
                        <button class="btn" onclick="window.addToCart(${product.id})" style="padding: 8px 15px; font-size: 0.9rem;">Add to Cart</button>
                    </th>
                `;
            });
            comparisonHTML += '</tr></thead>';
            
            // Comparison rows
            const features = [
                { name: 'Price', getValue: p => `$${p.price.toFixed(2)}` },
                { name: 'Rating', getValue: p => `${p.rating}/5 (${p.reviews} reviews)` },
                { name: 'Category', getValue: p => p.category === 'cover' ? 'Phone Cover' : 'Accessory' },
                { name: 'Stock', getValue: p => p.stock > 10 ? 'In Stock' : p.stock > 0 ? 'Low Stock' : 'Out of Stock' },
                { name: 'Description', getValue: p => p.description }
            ];
            
            comparisonHTML += '<tbody>';
            features.forEach(feature => {
                comparisonHTML += '<tr>';
                comparisonHTML += `<td style="padding: 15px; border-bottom: 1px solid #eee; font-weight: 500;">${feature.name}</td>`;
                productsToCompare.forEach(product => {
                    comparisonHTML += `<td style="padding: 15px; border-bottom: 1px solid #eee;">${feature.getValue(product)}</td>`;
                });
                comparisonHTML += '</tr>';
            });
            comparisonHTML += '</tbody></table></div>';
            
            // Display comparison modal
            const comparisonContent = document.getElementById('comparisonContent');
            const comparisonModal = document.getElementById('comparisonModal');
            
            if (comparisonContent && comparisonModal) {
                comparisonContent.innerHTML = comparisonHTML;
                comparisonModal.classList.add('active');
                
                // Close button
                const closeComparison = document.getElementById('closeComparison');
                if (closeComparison) {
                    closeComparison.addEventListener('click', () => {
                        comparisonModal.classList.remove('active');
                    });
                }
                
                // Close on click outside
                comparisonModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            }
        }
        
        // Update results count
        function updateResultsCount(count) {
            const resultsCount = document.getElementById('resultsCount');
            if (resultsCount) {
                resultsCount.textContent = count || 0;
            }
        }
        
        // Show product details
        function showProductDetails(productId) {
            const product = window.products.find(p => p.id === productId);
            if (!product) return;
            
            const modalContent = document.getElementById('modalContent');
            const modal = document.getElementById('productModal');
            
            if (!modalContent || !modal) return;
            
            modalContent.innerHTML = `
                <div class="modal-image">
                    <img src="${product.image}" alt="${product.name}">
                </div>
                <div class="modal-info">
                    <h2>${product.name}</h2>
                    <div class="product-rating-large">
                        ${generateStarRating(product.rating)}
                        <span class="rating-count">${product.reviews} reviews</span>
                    </div>
                    <div class="modal-price">
                        $${product.price.toFixed(2)}
                        ${product.originalPrice ? `<span class="original-price">$${product.originalPrice.toFixed(2)}</span>` : ''}
                        ${product.discount ? `<span class="discount-badge">${product.discount}% OFF</span>` : ''}
                    </div>
                    <p class="modal-description">${product.description}</p>
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="window.addToCart(${product.id})">
                            <i class="fas fa-shopping-cart"></i> Add to Cart
                        </button>
                        <button class="btn btn-secondary" onclick="window.toggleWishlist(${product.id})">
                            <i class="far fa-heart"></i> Add to Wishlist
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
            
            // Close button
            const closeModal = document.getElementById('closeModal');
            if (closeModal) {
                closeModal.addEventListener('click', () => {
                    modal.classList.remove('active');
                });
            }
        }
        
        // Show quick view
        function showQuickView(productId) {
            const product = window.products.find(p => p.id === productId);
            if (!product) return;
            
            alert(`Quick view: ${product.name}\nPrice: $${product.price.toFixed(2)}\nRating: ${product.rating}/5\n\nAdd to cart or view details for more information.`);
        }
    </script>
    
    <!-- Loading spinner CSS -->
    <style>
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .product-card.list-view {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
        }
        
        .product-card.list-view .product-image {
            height: 200px;
        }
        
        .compare-checkbox {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .compare-checkbox input {
            margin-right: 5px;
        }
    </style>
</body>
            </html>
